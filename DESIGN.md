# åŠ å¯†è´§å¸å¸‚åœºç›‘æ§ç³»ç»Ÿ - è®¾è®¡æ–‡æ¡£

## 1. æ¦‚è¿°

å®æ—¶ç›‘æ§ BTC/ETH çš„ä¸»åŠ›èµ„é‡‘æµå‘ã€æŒä»“å˜åŒ–ã€çˆ†ä»“æ•°æ®å’Œå¸‚åœºæƒ…ç»ªæŒ‡æ ‡ï¼Œé€šè¿‡ Telegram Bot æ¨é€å®šæ—¶æŠ¥å‘Šå’Œå¼‚å¸¸æé†’ã€‚

**å®šä½ï¼šæ•°æ®èšåˆå’Œæ¨é€å·¥å…·ï¼Œè¾…åŠ©ç”¨æˆ·è‡ªè¡Œåˆ¤æ–­ã€‚**

## 2. éœ€æ±‚æ‘˜è¦

| é¡¹ç›® | è§„æ ¼ |
|------|------|
| æ•°æ®æº | Binance + OKX åŒäº¤æ˜“æ‰€ |
| å¸ç§ | BTC/USDT, ETH/USDT (æ°¸ç»­åˆçº¦) |
| ä¸»åŠ›è¯†åˆ« | å¤§é¢ Taker è®¢å•ï¼ŒåŠ¨æ€é˜ˆå€¼ P95 |
| ç›‘æ§æ•°æ® | ä¸»åŠ›èµ„é‡‘æµå‘ã€OI å˜åŒ–ã€çˆ†ä»“ã€èµ„é‡‘è´¹ç‡ã€å¤šç©ºæ¯”ã€ç°è´§-åˆçº¦ä»·å·® |
| è¾“å‡º | TG Bot (å®šæ—¶æŠ¥å‘Š + å¼‚å¸¸æé†’ + ä»·ä½æé†’) |

## 3. ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Crypto Monitor                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Binance   â”‚  â”‚  Binance   â”‚  â”‚    OKX     â”‚  â”‚  REST API  â”‚    â”‚
â”‚  â”‚ WebSocket  â”‚  â”‚ WebSocket  â”‚  â”‚ WebSocket  â”‚  â”‚ (å®šæ—¶è·å–)  â”‚    â”‚
â”‚  â”‚ (trades)   â”‚  â”‚(forceOrder)â”‚  â”‚ (trades)   â”‚  â”‚            â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚        â”‚               â”‚               â”‚               â”‚            â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                â–¼               â–¼               â–¼                    â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚      â”‚                Data Collector                    â”‚           â”‚
â”‚      â”‚  - trades: å¤§å•è¿‡æ»¤ (P95)                        â”‚           â”‚
â”‚      â”‚  - liquidations: å®æ—¶çˆ†ä»“                        â”‚           â”‚
â”‚      â”‚  - OI/æŒ‡æ ‡: å®šæ—¶æ‹‰å– (5min)                      â”‚           â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                               â–¼                                     â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚      â”‚               Data Aggregator                    â”‚           â”‚
â”‚      â”‚  - è®¡ç®—ä¸»åŠ›èµ„é‡‘æµå‘ (1h/4h/24h)                   â”‚           â”‚
â”‚      â”‚  - è®¡ç®— OI å˜åŒ–ç‡                                â”‚           â”‚
â”‚      â”‚  - ç»Ÿè®¡çˆ†ä»“æ•°æ®                                  â”‚           â”‚
â”‚      â”‚  - æ•´åˆæƒ…ç»ªæŒ‡æ ‡                                  â”‚           â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                               â–¼                                     â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚      â”‚              Telegram Notifier                   â”‚           â”‚
â”‚      â”‚  - å®šæ—¶æŠ¥å‘Š (æ¯ 8h)                               â”‚           â”‚
â”‚      â”‚  - å¼‚å¸¸æé†’ (é˜ˆå€¼è§¦å‘)                            â”‚           â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                               â”‚                                     â”‚
â”‚      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚      â”‚                  SQLite DB                       â”‚           â”‚
â”‚      â”‚  - trades (å¤§å•, æ»šåŠ¨ 7d)                         â”‚           â”‚
â”‚      â”‚  - liquidations (çˆ†ä»“, æ»šåŠ¨ 7d)                   â”‚           â”‚
â”‚      â”‚  - oi_snapshots (OI å¿«ç…§)                        â”‚           â”‚
â”‚      â”‚  - snapshots (å®šæ—¶å¿«ç…§, ç”¨äºå†å²æŸ¥è¯¢)             â”‚           â”‚
â”‚      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 4. æ¨¡å—è®¾è®¡

### 4.1 é¡¹ç›®ç»“æ„

```
crypto_monitor/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # å…¥å£
â”‚   â”œâ”€â”€ config.py               # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ collector/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ base.py             # åŸºç±»
â”‚   â”‚   â”œâ”€â”€ binance_trades.py   # Binance trades WebSocket (ccxt)
â”‚   â”‚   â”œâ”€â”€ binance_liq.py      # Binance çˆ†ä»“ WebSocket (åŸç”Ÿ)
â”‚   â”‚   â”œâ”€â”€ okx_trades.py       # OKX trades WebSocket (ccxt)
â”‚   â”‚   â””â”€â”€ indicator_fetcher.py# OI/æŒ‡æ ‡ å®šæ—¶è·å– (ccxt REST)
â”‚   â”œâ”€â”€ aggregator/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ flow.py             # èµ„é‡‘æµå‘è®¡ç®—
â”‚   â”‚   â”œâ”€â”€ oi.py               # OI å˜åŒ–è®¡ç®—
â”‚   â”‚   â”œâ”€â”€ liquidation.py      # çˆ†ä»“ç»Ÿè®¡
â”‚   â”‚   â”œâ”€â”€ snapshot.py         # å¿«ç…§ç”Ÿæˆ
â”‚   â”‚   â””â”€â”€ percentile.py       # ç™¾åˆ†ä½è®¡ç®—
â”‚   â”œâ”€â”€ alert/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ trigger.py          # å¼‚å¸¸è§¦å‘æ£€æµ‹
â”‚   â”‚   â””â”€â”€ price_monitor.py    # ä»·ä½ç›‘æ§
â”‚   â”œâ”€â”€ notifier/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ telegram.py         # TG Bot
â”‚   â”œâ”€â”€ storage/
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â””â”€â”€ database.py         # SQLite æ“ä½œ
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â””â”€â”€ helpers.py          # å·¥å…·å‡½æ•°
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ ...
â”œâ”€â”€ config.example.yaml
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile
â”œâ”€â”€ pyproject.toml
â””â”€â”€ README.md
```

### 4.2 æ•°æ®åº“è®¾è®¡

```sql
-- å¤§å•è®°å½• (æ»šåŠ¨ä¿ç•™ 7 å¤©)
CREATE TABLE trades (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    exchange TEXT NOT NULL,           -- 'binance' | 'okx'
    symbol TEXT NOT NULL,             -- 'BTC/USDT:USDT'
    timestamp INTEGER NOT NULL,       -- æ¯«ç§’æ—¶é—´æˆ³
    price REAL NOT NULL,
    amount REAL NOT NULL,
    side TEXT NOT NULL,               -- 'buy' | 'sell'
    value_usd REAL NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_trades_symbol_time ON trades(symbol, timestamp);

-- çˆ†ä»“è®°å½• (æ»šåŠ¨ä¿ç•™ 7 å¤©)
CREATE TABLE liquidations (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    exchange TEXT NOT NULL,
    symbol TEXT NOT NULL,
    timestamp INTEGER NOT NULL,
    side TEXT NOT NULL,               -- 'buy'=ç©ºå¤´çˆ†ä»“, 'sell'=å¤šå¤´çˆ†ä»“
    price REAL NOT NULL,
    quantity REAL NOT NULL,
    value_usd REAL NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_liq_symbol_time ON liquidations(symbol, timestamp);

-- OI å¿«ç…§ (æ¯ 5 åˆ†é’Ÿ)
CREATE TABLE oi_snapshots (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    exchange TEXT NOT NULL,
    symbol TEXT NOT NULL,
    timestamp INTEGER NOT NULL,
    open_interest REAL NOT NULL,      -- å¸æœ¬ä½
    open_interest_usd REAL NOT NULL,  -- USD
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_oi_symbol_time ON oi_snapshots(symbol, timestamp);

-- å¸‚åœºå¿«ç…§ (æ¯æ¬¡æŠ¥å‘Šæ—¶ä¿å­˜ï¼Œä¾¿äºå†å²æŸ¥è¯¢)
CREATE TABLE snapshots (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    symbol TEXT NOT NULL,
    timestamp INTEGER NOT NULL,
    price REAL NOT NULL,

    -- ä¸»åŠ›èµ„é‡‘
    flow_1h REAL,
    flow_4h REAL,
    flow_24h REAL,
    flow_1h_binance REAL,
    flow_1h_okx REAL,

    -- OI
    oi_value REAL,
    oi_change_1h REAL,
    oi_change_4h REAL,

    -- çˆ†ä»“
    liq_long_1h REAL,
    liq_short_1h REAL,
    liq_long_4h REAL,
    liq_short_4h REAL,

    -- æƒ…ç»ªæŒ‡æ ‡
    funding_rate REAL,
    long_short_ratio REAL,
    spot_perp_spread REAL,

    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_snapshot_symbol_time ON snapshots(symbol, timestamp);

-- åŠ¨æ€é˜ˆå€¼
CREATE TABLE thresholds (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    symbol TEXT NOT NULL,
    p95_value REAL NOT NULL,
    sample_count INTEGER NOT NULL,
    calculated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ä»·ä½ç›‘æ§
CREATE TABLE price_alerts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    symbol TEXT NOT NULL,             -- 'BTC' | 'ETH'
    price REAL NOT NULL,              -- ç›®æ ‡ä»·ä½
    last_position TEXT,               -- 'above' | 'below' (ä¸Šæ¬¡ä»·æ ¼ä½ç½®)
    last_triggered_at INTEGER,        -- ä¸Šæ¬¡è§¦å‘æ—¶é—´æˆ³ (å†·å´ç”¨)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CREATE INDEX idx_price_alerts_symbol ON price_alerts(symbol);
```

### 4.3 æ ¸å¿ƒè®¡ç®—

#### 4.3.1 ä¸»åŠ›èµ„é‡‘æµå‘

```python
def calculate_flow(symbol: str, hours: int) -> FlowResult:
    """è®¡ç®—æŒ‡å®šçª—å£çš„å¤§å•å‡€æµå‘"""
    trades = db.get_trades(symbol, hours=hours)

    buy = sum(t.value_usd for t in trades if t.side == 'buy')
    sell = sum(t.value_usd for t in trades if t.side == 'sell')
    net = buy - sell

    return FlowResult(net=net, buy=buy, sell=sell)
```

#### 4.3.2 OI å˜åŒ–

```python
def calculate_oi_change(symbol: str, hours: int) -> float:
    """è®¡ç®— OI å˜åŒ–ç‡ (%)"""
    current = db.get_latest_oi(symbol)
    past = db.get_oi_at(symbol, hours_ago=hours)

    if not current or not past or past.value == 0:
        return 0.0

    return (current.value - past.value) / past.value * 100
```

#### 4.3.3 çˆ†ä»“ç»Ÿè®¡

```python
def get_liquidations(symbol: str, hours: int) -> LiqStats:
    """ç»Ÿè®¡çˆ†ä»“æ•°æ®"""
    liqs = db.get_liquidations(symbol, hours=hours)

    long_liq = sum(l.value_usd for l in liqs if l.side == 'sell')
    short_liq = sum(l.value_usd for l in liqs if l.side == 'buy')

    return LiqStats(long=long_liq, short=short_liq)
```

#### 4.3.4 OI + ä»·æ ¼è§£è¯»

```python
def interpret_oi_price(oi_change: float, price_change: float) -> str:
    """OI ä¸ä»·æ ¼å˜åŒ–ç»„åˆè§£è¯»"""
    if oi_change > 1 and price_change > 0:
        return "æ–°å¤šå…¥åœº"
    elif oi_change > 1 and price_change < 0:
        return "æ–°ç©ºå…¥åœº"
    elif oi_change < -1 and price_change > 0:
        return "ç©ºå¤´å¹³ä»“"
    elif oi_change < -1 and price_change < 0:
        return "å¤šå¤´å¹³ä»“"
    else:
        return "æŒä»“ç¨³å®š"
```

### 4.4 å¼‚å¸¸æé†’ (å¯é…ç½®)

```yaml
alerts:
  whale_flow:
    enabled: true
    threshold_usd: 10000000    # 1h å¤§å•å‡€æµå…¥/æµå‡º > $10M
  oi_change:
    enabled: true
    threshold_pct: 3           # 1h OI å˜åŒ– > 3%
  liquidation:
    enabled: true
    threshold_usd: 20000000    # 1h çˆ†ä»“ > $20M
```

è§¦å‘æ—¶æ¨é€ï¼š

```
âš ï¸ BTC å¼‚å¸¸æé†’

ä¸»åŠ›å¤§å• 1h å‡€æµå‡º $15.2M ğŸ”´ P96
Binance: -$10.1M | OKX: -$5.1M

å½“å‰ä»·æ ¼: $103,850 (-0.8% 1h)

â° 2026-01-30 14:32 UTC
```

### 4.5 ä»·ä½ç›‘æ§

ç”¨æˆ·é€šè¿‡ Telegram å‘½ä»¤è®¾ç½®å…³é”®ä»·ä½ï¼Œä»·æ ¼çªç ´/è·Œç ´æ—¶æ¨é€å¸‚åœºæ•°æ®å¿«ç…§ã€‚

**è§¦å‘é€»è¾‘ï¼š**
- åŒå‘ç›‘æ§ï¼šè®°å½•è®¾ç½®æ—¶çš„ä»·æ ¼ä½ç½®ï¼ˆé«˜äº/ä½äºç›®æ ‡ä»·ï¼‰
- ä»ä¸Šæ–¹è·Œç ´ â†’ æé†’"è·Œç ´ xxx"
- ä»ä¸‹æ–¹çªç ´ â†’ æé†’"çªç ´ xxx"
- è§¦å‘åä¿ç•™ç›‘æ§ï¼Œè®¾ç½®å†·å´æ—¶é—´ï¼ˆé»˜è®¤ 1 å°æ—¶ï¼‰é¿å…éœ‡è¡æ—¶åˆ·å±

```python
def check_price_alerts(symbol: str, current_price: float) -> list[Alert]:
    """æ£€æŸ¥ä»·ä½æ˜¯å¦è§¦å‘"""
    alerts = db.get_price_alerts(symbol)
    triggered = []

    for alert in alerts:
        # æ£€æŸ¥å†·å´
        if alert.last_triggered_at:
            cooldown = config.price_alerts.cooldown_minutes * 60
            if time.time() - alert.last_triggered_at < cooldown:
                continue

        # æ£€æŸ¥çªç ´/è·Œç ´
        if alert.last_position == 'below' and current_price >= alert.price:
            triggered.append(Alert(type='breakout', price=alert.price))
            db.update_alert(alert.id, position='above', triggered_at=now)
        elif alert.last_position == 'above' and current_price <= alert.price:
            triggered.append(Alert(type='breakdown', price=alert.price))
            db.update_alert(alert.id, position='below', triggered_at=now)

    return triggered
```

### 4.6 æ•°æ®çº§åˆ« (ç™¾åˆ†ä½)

æ‰€æœ‰æŒ‡æ ‡æ˜¾ç¤º Emoji + ç™¾åˆ†ä½ï¼Œå¸®åŠ©å¿«é€Ÿåˆ¤æ–­å½“å‰æ•°æ®å¤„äºå†å²ä»€ä¹ˆæ°´å¹³ã€‚

**çº§åˆ«åˆ’åˆ†ï¼š**

| ç™¾åˆ†ä½ | Emoji | å«ä¹‰ |
|--------|-------|------|
| < P75 | ğŸŸ¢ | æ­£å¸¸èŒƒå›´ |
| P75 - P90 | ğŸŸ¡ | åé«˜ï¼Œå€¼å¾—å…³æ³¨ |
| > P90 | ğŸ”´ | æç«¯ï¼Œéœ€è¦æ³¨æ„ |

```python
def get_level_emoji(percentile: float) -> str:
    """æ ¹æ®ç™¾åˆ†ä½è¿”å›çº§åˆ« emoji"""
    if percentile < 75:
        return "ğŸŸ¢"
    elif percentile < 90:
        return "ğŸŸ¡"
    else:
        return "ğŸ”´"

def calculate_percentile(value: float, history: list[float]) -> float:
    """è®¡ç®—å½“å‰å€¼åœ¨å†å²æ•°æ®ä¸­çš„ç™¾åˆ†ä½"""
    if not history:
        return 50.0
    count_below = sum(1 for h in history if h < abs(value))
    return count_below / len(history) * 100
```

ç™¾åˆ†ä½åŸºäºæœ€è¿‘ 7 å¤©æ•°æ®ï¼Œæ¯å°æ—¶æ›´æ–°ä¸€æ¬¡ã€‚

### 4.7 Telegram Bot å‘½ä»¤

| å‘½ä»¤ | è¯´æ˜ |
|------|------|
| `/watch BTC 100000` | æ·»åŠ  BTC 100000 ä»·ä½ç›‘æ§ |
| `/unwatch BTC 100000` | å–æ¶ˆ BTC 100000 ä»·ä½ç›‘æ§ |
| `/list` | æŸ¥çœ‹æ‰€æœ‰ç›‘æ§ä»·ä½ |
| `/report BTC` | æ‰‹åŠ¨æ‹‰å– BTC æŠ¥å‘Š |
| `/status` | æŸ¥çœ‹ç³»ç»Ÿè¿è¡ŒçŠ¶æ€ |

**/list å“åº”ç¤ºä¾‹ï¼š**
```
ğŸ“‹ å½“å‰ç›‘æ§ä»·ä½

BTC:
  â€¢ 100000
  â€¢ 95000
  â€¢ 108000

ETH:
  â€¢ 3200
  â€¢ 3500
```

**/status å“åº”ç¤ºä¾‹ï¼š**
```
ğŸ”§ ç³»ç»ŸçŠ¶æ€

è¿è¡Œæ—¶é—´: 3d 12h 25m
æ•°æ®è¿æ¥:
  Binance WS: ğŸŸ¢ æ­£å¸¸
  OKX WS: ğŸŸ¢ æ­£å¸¸

æœ€åæ›´æ–°:
  Trades: 2s å‰
  OI: 3m å‰
  æŒ‡æ ‡: 4m å‰

æ•°æ®åº“: 1.2GB (7d æ•°æ®)
```

### 4.8 é…ç½®æ–‡ä»¶

```yaml
# config.yaml
exchanges:
  binance:
    enabled: true
  okx:
    enabled: true

symbols:
  - BTC/USDT:USDT
  - ETH/USDT:USDT

thresholds:
  default_usd: 100000
  percentile: 95
  update_interval_hours: 1

intervals:
  oi_fetch_minutes: 5
  indicator_fetch_minutes: 5
  report_hours: 8
  cleanup_hours: 24

alerts:
  whale_flow:
    enabled: true
    threshold_usd: 10000000
  oi_change:
    enabled: true
    threshold_pct: 3
  liquidation:
    enabled: true
    threshold_usd: 20000000

telegram:
  bot_token: "YOUR_BOT_TOKEN"
  chat_id: "YOUR_CHAT_ID"

database:
  path: "data/monitor.db"
  retention_days: 7

# ä»·ä½ç›‘æ§
price_alerts:
  cooldown_minutes: 60            # åŒä¸€ä»·ä½è§¦å‘å†·å´æ—¶é—´

# ç™¾åˆ†ä½è®¡ç®—
percentile:
  window_days: 7                  # åŸºäºæœ€è¿‘ 7 å¤©æ•°æ®
  update_interval_minutes: 60     # æ¯å°æ—¶æ›´æ–°ä¸€æ¬¡

# ç™¾åˆ†ä½çº§åˆ«åˆ’åˆ†
percentile_levels:
  normal_below: 75                # < P75 æ˜¾ç¤º ğŸŸ¢
  warning_below: 90               # P75-P90 æ˜¾ç¤º ğŸŸ¡, > P90 æ˜¾ç¤º ğŸ”´
```

## 5. è¾“å‡ºæ ¼å¼

### 5.1 å®šæ—¶æŠ¥å‘Š (å¯é…ç½®é—´éš”)

```
ğŸ“Š BTC å¸‚åœºå¿«ç…§
â° 2026-01-30 08:00 UTC

ğŸ’µ $104,230 (+1.2% 1h / +3.5% 24h)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’° ä¸»åŠ›èµ„é‡‘ (å¤§å•å‡€æµå‘):
  1h: +$5.2M ğŸŸ¢ P62 | 4h: +$18.3M ğŸŸ¡ P78
  24h: +$42.1M ğŸŸ¢ P55
  Binance: +$28M | OKX: +$14M âœ“ä¸€è‡´

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“ˆ æŒä»“é‡ (OI): $18.2B
  1h: +1.2% ğŸŸ¢ P58 | 4h: +2.3% ğŸŸ¡ P76
  â†’ ä»·æ ¼â†‘ OIâ†‘ = æ–°å¤šå…¥åœº

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ’¥ çˆ†ä»“:
  1h: $7.4M ğŸŸ¢ P52 (å¤š$2.1M / ç©º$5.3M)
  4h: $20.3M ğŸŸ¡ P82 (å¤š$8.2M / ç©º$12.1M)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“Š æƒ…ç»ªæŒ‡æ ‡:
  èµ„é‡‘è´¹ç‡: -0.01% ğŸŸ¢ P48 (ç©ºå¤´ä»˜è´¹)
  å¤šç©ºæ¯”: 1.35 ğŸŸ¢ P62 (æ•£æˆ·åå¤š)
  åˆçº¦æº¢ä»·: +0.05% ğŸŸ¢ P44
```

### 5.2 å¼‚å¸¸æé†’

```
âš ï¸ BTC å¤§å•å¼‚å¸¸

1h å‡€æµå‡º $15.2M ğŸ”´ P96
  Binance: -$10.1M
  OKX: -$5.1M

ğŸ’µ $103,850 (-0.8% 1h)
â° 2026-01-30 14:32 UTC
```

```
âš ï¸ ETH OI å¼‚å¸¸

1h OI å˜åŒ–: +4.2% ğŸ”´ P94
å½“å‰ OI: $8.5B

ğŸ’µ $3,420 (+0.5% 1h)
â†’ ä»·æ ¼â†‘ OIâ†‘ = æ–°å¤šå…¥åœº

â° 2026-01-30 14:32 UTC
```

```
âš ï¸ BTC çˆ†ä»“å¼‚å¸¸

1h æ€»çˆ†ä»“: $35.2M ğŸ”´ P95
  å¤šå¤´çˆ†ä»“: $28.1M (80%)
  ç©ºå¤´çˆ†ä»“: $7.1M

ğŸ’µ $101,200 (-2.8% 1h)
â° 2026-01-30 14:32 UTC
```

### 5.3 ä»·ä½æé†’

```
ğŸ“ BTC çªç ´ 100000

ğŸ’µ å½“å‰: $100,150 (+0.3% 1h)

ğŸ’° ä¸»åŠ›èµ„é‡‘ 1h: +$3.2M ğŸŸ¢ P62
ğŸ“ˆ OI å˜åŒ– 1h: +2.8% ğŸŸ¡ P85
ğŸ’¥ çˆ†ä»“ 1h: $8.5M ğŸŸ¢ P58 (å¤š$3.2M / ç©º$5.3M)
ğŸ“Š èµ„é‡‘è´¹ç‡: +0.01% ğŸŸ¢ P45

â° 2026-01-30 14:32 UTC
```

```
ğŸ“ ETH è·Œç ´ 3200

ğŸ’µ å½“å‰: $3,185 (-0.5% 1h)

ğŸ’° ä¸»åŠ›èµ„é‡‘ 1h: -$2.1M ğŸŸ¡ P78
ğŸ“ˆ OI å˜åŒ– 1h: -1.2% ğŸŸ¢ P65
ğŸ’¥ çˆ†ä»“ 1h: $12.3M ğŸŸ¡ P82 (å¤š$9.1M / ç©º$3.2M)
ğŸ“Š èµ„é‡‘è´¹ç‡: -0.02% ğŸŸ¢ P52

â° 2026-01-30 14:32 UTC
```

## 6. éƒ¨ç½²

### 6.1 Docker Compose

```yaml
version: '3.8'

services:
  crypto-monitor:
    build: .
    container_name: crypto-monitor
    restart: unless-stopped
    volumes:
      - ./data:/app/data
      - ./config.yaml:/app/config.yaml:ro
    environment:
      - TZ=UTC
```

### 6.2 ç¯å¢ƒè¦æ±‚

- Python 3.11+
- ç¨³å®šç½‘ç»œè¿æ¥

## 7. åç»­æ‰©å±•

- [ ] ä¿¡å·é€»è¾‘ (åŸºäºæ•°æ®ç§¯ç´¯åéªŒè¯)
- [ ] Web ç•Œé¢
- [ ] æ›´å¤šå¸ç§
- [ ] è‡ªå®šä¹‰æé†’æ¡ä»¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: v2.1
**æ›´æ–°æ—¶é—´**: 2026-01-30
